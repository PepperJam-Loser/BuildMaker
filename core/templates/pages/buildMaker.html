<!DOCTYPE html>
{% extends 'main.html' %}
{% load static %}
{% block layout %}

<div class="flex w-full">
    <div class="flex flex-col w-3/4 gap-1">
        <button onclick="openWeaponSearch()" id="weaponButton" class="btn btn-primary">Weapon</button>
        <button onclick="openSearch('head')" id="headButton" class="btn btn-primary">Head</button>
        <button onclick="openSearch('chest')" id="chestButton" class="btn btn-primary">Chest</button>
        <button onclick="openSearch('arms')" id="armsButton" class="btn btn-primary">Arms</button>
        <button onclick="openSearch('waist')" id="waistButton" class="btn btn-primary">Waist</button>
        <button onclick="openSearch('legs')" id="legsButton" class="btn btn-primary">Legs</button>
        <button onclick="openSearch('charm')" id="charmButton" class="btn btn-primary">Charm</button>
        <input type="hidden" id="selectedWeaponId">
    </div>

    <div class="divider divider-horizontal"></div>

    <div class="flex flex-col w-1/4">
        <div tabindex="0" class="collapse collapse bg-base-200">
            <div class="collapse-title text-xl font-medium">Stats</div>
        </div>
    </div>
</div>

<div id="weaponModal" class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 hidden">
    <div class="bg-white p-4 rounded-lg shadow-lg w-1/2 max-h-[80vh] overflow-y-auto">
        <h2 class="text-xl font-bold mb-4">Weapon Search</h2>
        <button onclick="closeWeaponSearch()" class="btn btn-secondary mt-4">Close</button>
        <div class="flex flex-wrap justify-center gap-4">
            {% for weapon, abrv in weapon_types.items %}
            <button onclick="fetchWeapons('{{ weapon }}')" class="btn btn-primary capitalize">
                {{ abrv }}
            </button>
            {% endfor %}
        </div>
        <div class="divider"></div>
        <div id="weaponList" class="flex flex-wrap justify-center gap-4"></div>
    </div>
</div>

<script>
    function openWeaponSearch() {
        document.getElementById("weaponModal").classList.remove("hidden");
    }

    function closeWeaponSearch() {
        document.getElementById("weaponModal").classList.add("hidden");
    }

    function fetchWeapons(type) {
        fetch(`/weapon_search?type=${type}`)
            .then(response => response.json())
            .then(data => {
                if (data.error) {
                    console.error("Error:", data.error);
                    return;
                }

                const weaponList = document.getElementById("weaponList");
                weaponList.innerHTML = '';

                data.weapons.forEach(weapon => {
                    const button = document.createElement("button");
                    button.classList.add("btn", "btn-primary", "m-1");
                    button.textContent = weapon.name;
                    button.onclick = () => selectWeapon(weapon.id, weapon.name);
                    weaponList.appendChild(button);
                });
            })
            .catch(error => console.error("Fetch error:", error));
    }

    function selectWeapon(weaponId, weaponName) {
        document.getElementById("selectedWeaponId").value = weaponId;
        document.getElementById("weaponModal").classList.add("hidden");
        alert(selectedWeaponId.value);
        
    }
</script>

{% endblock layout %}